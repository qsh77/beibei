# 4.4 系统功能模块详细设计

通过前面的需求分析和总体设计，已经明确了贝贝家政服务系统在开发时需要实现的功能和构建的架构。本节主要利用类图、时序图、活动图对本系统主要功能的实现过程进行详细的描述。

---

## 4.4.1 服务预约功能详细设计

### 活动图

服务预约是用户使用家政服务的核心入口功能。用户从打开家政服务平台开始，浏览服务列表。系统前端展示所有可用的家政服务项目，并提供分类筛选和搜索功能，以便用户快速找到所需服务。用户选择目标服务后，查看服务详情了解具体内容、价格和用户评价。确认选择该服务后，用户需要选择预约日期和时间段。接下来用户选择服务地址，可以从已保存的常用地址中选择，也可以新增一个服务地址。系统前端显示订单总览，包括服务项目、预约时间、服务地址和订单金额。用户确认信息无误后提交订单，系统后端创建订单记录并设置状态为"等待抢单"。用户接收到订单创建成功的提示，等待阿姨接单。服务预约功能活动图如图4.1所示。

![服务预约功能活动图](图/活动图&时序图/4.4.1_服务预约_活动图.png)

### 时序图

（1）浏览服务列表：用户进入服务列表页面请求查看所有可用的家政服务，前端页面向ServiceController发送GET请求，通过ServiceService获取服务数据后展示给用户。

（2）选择服务信息：用户从服务列表中选择目标服务，并在前端页面选择预约日期、时间段和服务地址，这些操作在前端界面完成。

（3）提交预约订单：用户确认订单信息后提交预约，前端向OrderController发送POST请求创建订单，OrderService验证服务和地址的有效性后，将订单数据插入数据库，最后返回订单创建成功的消息给用户。

服务预约功能时序图如图4.2所示。

![服务预约功能时序图](图/活动图&时序图/4.4.1_服务预约_时序图.png)

---

## 4.4.2 订单分配功能详细设计

### 活动图

订单分配是管理员进行平台运营调度的核心功能。管理员登录管理后台后，进入订单管理页面。系统前端展示所有订单列表，管理员可通过状态筛选查看"等待抢单"的待分配订单。管理员选择一个待分配订单，查看订单详情了解服务内容、预约时间和服务地址等信息。确认需要分配后，管理员点击分配按钮，系统获取并展示可用阿姨列表。管理员根据阿姨的技能特长、服务评分、工作年限和档期安排等信息进行筛选，选择最合适的阿姨。确认分配后，系统后端更新订单状态为"已接单"，并记录分配的阿姨ID。管理员接收到分配成功的提示，完成订单调度工作。订单分配功能活动图如图4.3所示。

![订单分配功能活动图](图/活动图&时序图/4.4.2_订单分配_活动图.png)

### 时序图

（1）查看待分配订单：管理员进入订单管理页面请求查看待分配订单列表，前端向AdminOrderController发送带状态筛选参数的GET请求，通过AdminOrderService分页查询订单数据后展示给管理员。

（2）获取可用阿姨列表：管理员点击分配订单按钮，前端向AdminWorkerController发送GET请求，通过AdminWorkerService查询可用阿姨信息后展示给管理员选择。

（3）确认分配订单：管理员选择目标阿姨后确认分配，前端向OrderController发送PUT请求，OrderService更新订单的阿姨ID和状态字段，将状态变更为"已接单"，最后返回分配成功的消息给管理员。

订单分配功能时序图如图4.4所示。

![订单分配功能时序图](图/活动图&时序图/4.4.2_订单分配_时序图.png)

---

## 4.4.3 阿姨接单与服务执行功能详细设计

### 活动图

阿姨接单与服务执行是家政服务交付的核心环节。阿姨登录阿姨端后，进入工作台页面。阿姨可以选择查看可接订单或处理已接订单两种操作。在查看可接订单流程中，系统根据阿姨的档期安排自动过滤展示可以接取的订单列表。阿姨浏览订单详情，了解服务内容、预约时间和服务地址后，决定是否接单。确认接单后，系统后端更新订单状态为"已接单"并关联阿姨ID。在处理已接订单流程中，阿姨查看自己已接取的订单列表，选择要处理的订单。如果订单状态为"已接单"，阿姨在约定时间到达服务地址后点击"开始服务"，系统将状态更新为"服务中"。服务完成后，阿姨点击"完成服务"，系统将状态更新为"已完成"，整个服务流程结束。阿姨接单与服务执行功能活动图如图4.5所示。

![阿姨接单与服务执行功能活动图](图/活动图&时序图/4.4.3_阿姨接单_活动图.png)

### 时序图

（1）查看可接订单：阿姨进入可接订单页面，前端向WorkerOrderController发送GET请求获取可接订单列表，WorkerOrderService根据阿姨档期过滤订单后返回数据展示。

（2）主动接单：阿姨选择订单后点击接单，前端向WorkerOrderController发送PUT请求，WorkerOrderService验证订单状态为"等待抢单"后，更新订单的阿姨ID和状态，返回接单成功消息。

（3）开始服务：阿姨到达服务地址后点击开始服务，前端向WorkerOrderController发送PUT请求，WorkerOrderService将订单状态更新为"服务中"。

（4）完成服务：阿姨完成服务后点击完成，前端向WorkerOrderController发送PUT请求，WorkerOrderService将订单状态更新为"已完成"，返回订单完成消息。

阿姨接单与服务执行功能时序图如图4.6所示。

![阿姨接单与服务执行功能时序图](图/活动图&时序图/4.4.3_阿姨接单_时序图.png)

---

## 4.4.4 服务评价功能详细设计

### 活动图

服务评价是用户对已完成家政服务进行反馈的功能，也是平台服务质量管理的重要环节。用户登录后进入"我的订单"页面，筛选查看"已完成"状态的订单。系统前端展示已完成订单列表，用户选择一个需要评价的订单。系统判断该订单是否已评价，如果已评价则展示已有评价内容；如果未评价，用户点击评价按钮打开评价弹窗。用户填写服务评分（1-5星）和评价描述文字，可以对服务质量、阿姨态度、准时程度等方面进行评价。用户确认提交后，系统后端保存评价记录到数据库，关联订单ID、用户ID、阿姨ID和服务ID。同时系统更新阿姨的综合评分。用户接收到评价成功的提示，评价内容将展示在对应服务的详情页面供其他用户参考。服务评价功能活动图如图4.7所示。

![服务评价功能活动图](图/活动图&时序图/4.4.4_服务评价_活动图.png)

### 时序图

（1）检查评价状态：用户点击评价按钮时，前端向ReviewController发送GET请求检查该订单是否已评价，ReviewService查询数据库返回评价状态。

（2）填写评价信息：用户在评价弹窗中填写评分和评价内容，这个步骤在前端界面完成，不需要后端数据交互。

（3）提交评价：用户提交评价后，前端向ReviewController发送POST请求，ReviewService验证订单状态为"已完成"且未评价后，将评价数据插入数据库，同时更新阿姨的综合评分，最后返回评价成功消息。

服务评价功能时序图如图4.8所示。

![服务评价功能时序图](图/活动图&时序图/4.4.4_服务评价_时序图.png)

---

## 4.4.5 统计分析功能详细设计

### 活动图

统计分析是管理员进行平台运营决策的重要支撑功能。管理员登录管理后台后，进入统计分析页面。系统自动并行加载多项统计数据，包括概览统计、订单趋势、收入趋势、订单状态分布、热门服务排行和活跃阿姨排行。数据加载完成后，系统使用ECharts图表库渲染各类可视化图表：柱状图展示订单趋势，折线图展示收入趋势，饼状图展示订单状态分布。管理员查看统计数据，可以切换时间范围（如7天、30天、12个月）查看不同周期的趋势变化。系统根据选择的时间范围重新加载趋势数据并更新图表。管理员还可以点击排行榜中的项目跳转到对应的管理页面查看详情。管理员根据统计数据分析平台运营状况，为业务决策提供数据支撑。统计分析功能活动图如图4.9所示。

![统计分析功能活动图](图/活动图&时序图/4.4.5_统计分析_活动图.png)

### 时序图

（1）加载概览统计：管理员进入统计分析页面，前端向StatsController发送GET请求获取概览数据，StatsService执行聚合查询统计用户数、订单数、收入等数据后返回。

（2）加载订单趋势：前端并行向StatsController发送GET请求获取订单趋势数据，StatsService按日期分组统计订单数量和收入金额后返回趋势数据。

（3）加载订单状态分布：前端向StatsController发送GET请求获取订单状态统计，StatsService按状态分组统计各状态订单数量后返回分布数据。

（4）渲染可视化图表：前端使用ECharts将返回的数据渲染为柱状图、折线图、饼状图等可视化图表展示给管理员。

（5）切换时间范围：管理员选择不同的时间范围后，前端向StatsController发送带时间参数的GET请求，StatsService重新查询指定时间范围的数据，前端更新图表展示。

统计分析功能时序图如图4.10所示。

![统计分析功能时序图](图/活动图&时序图/4.4.5_统计分析_时序图.png)
