# 4.3.2 数据库表结构设计

## 表4.1 用户表（user）

用户表用来保存系统用户的基本账号信息，该表包含用户ID、手机号、密码哈希、角色、状态等字段，其中用户ID是主键且自增，手机号为唯一约束。用户表的完整表结构设计如表4.1所示。

| 序号 | 字段名称 | 数据类型 | 长度 | 约束条件 | 字段说明 |
|------|----------|----------|------|----------|----------|
| 1 | id | bigint | 默认 | 主键，自增 | 用户ID |
| 2 | phone | varchar | 20 | 唯一，非空 | 手机号 |
| 3 | password_hash | varchar | 100 | 非空 | 密码哈希 |
| 4 | role | enum | - | 非空 | 角色(USER/WORKER/ADMIN) |
| 5 | status | tinyint | 默认 | 非空 | 状态(1启用/0禁用) |
| 6 | created_at | timestamp | 默认 | 非空 | 创建时间 |
| 7 | updated_at | timestamp | 默认 | 非空 | 更新时间 |

## 表4.2 用户资料表（user_profile）

用户资料表用来保存用户的详细个人信息，该表包含用户ID、姓名、性别、生日、头像、邮箱、地址等字段，其中用户ID是主键，同时也是外键，参考用户表的用户ID。用户资料表的完整表结构设计如表4.2所示。

| 序号 | 字段名称 | 数据类型 | 长度 | 约束条件 | 字段说明 |
|------|----------|----------|------|----------|----------|
| 1 | user_id | bigint | 默认 | 主键，外键 | 用户ID |
| 2 | name | varchar | 50 | 可空 | 姓名 |
| 3 | gender | enum | - | 可空 | 性别(M男/F女/U未知) |
| 4 | birthday | date | 默认 | 可空 | 生日 |
| 5 | avatar | text | 默认 | 可空 | 头像URL |
| 6 | email | varchar | 100 | 可空 | 邮箱 |
| 7 | address | varchar | 255 | 可空 | 地址 |

## 表4.3 用户地址表（user_address）

用户地址表用来保存用户的收货地址信息，该表包含地址ID、用户ID、联系人姓名、联系电话、省市区、详细地址等字段，其中地址ID是主键且自增，用户ID是外键，参考用户表的用户ID。用户地址表的完整表结构设计如表4.3所示。

| 序号 | 字段名称 | 数据类型 | 长度 | 约束条件 | 字段说明 |
|------|----------|----------|------|----------|----------|
| 1 | id | bigint | 默认 | 主键，自增 | 地址ID |
| 2 | user_id | bigint | 默认 | 外键，非空 | 用户ID |
| 3 | contact_name | varchar | 50 | 可空 | 联系人姓名 |
| 4 | contact_phone | varchar | 20 | 可空 | 联系电话 |
| 5 | province | varchar | 50 | 可空 | 省份 |
| 6 | city | varchar | 50 | 可空 | 城市 |
| 7 | district | varchar | 50 | 可空 | 区县 |
| 8 | detail | varchar | 200 | 可空 | 详细地址 |
| 9 | is_default | tinyint | 默认 | 非空 | 是否默认(1是/0否) |
| 10 | created_at | timestamp | 默认 | 非空 | 创建时间 |

## 表4.4 服务人员表（worker）

服务人员表用来保存家政服务人员的信息，该表包含服务人员ID、关联用户ID、等级、从业年限、个人简介、评分、状态等字段，其中服务人员ID是主键且自增，用户ID是外键且唯一，参考用户表的用户ID。服务人员表的完整表结构设计如表4.4所示。

| 序号 | 字段名称 | 数据类型 | 长度 | 约束条件 | 字段说明 |
|------|----------|----------|------|----------|----------|
| 1 | id | bigint | 默认 | 主键，自增 | 服务人员ID |
| 2 | user_id | bigint | 默认 | 唯一，外键 | 关联用户ID |
| 3 | level | tinyint | 默认 | 可空 | 等级(默认1) |
| 4 | years | smallint | 默认 | 可空 | 从业年限 |
| 5 | bio | varchar | 500 | 可空 | 个人简介 |
| 6 | score | decimal | (3,2) | 非空 | 评分(默认5.00) |
| 7 | status | tinyint | 默认 | 非空 | 状态(1启用/0禁用) |

## 表4.5 服务人员排班表（worker_schedule）

服务人员排班表用来保存服务人员的工作时间安排，该表包含排班ID、服务人员ID、日期、时间段、状态等字段，其中排班ID是主键且自增，服务人员ID是外键，参考服务人员表的服务人员ID。服务人员排班表的完整表结构设计如表4.5所示。

| 序号 | 字段名称 | 数据类型 | 长度 | 约束条件 | 字段说明 |
|------|----------|----------|------|----------|----------|
| 1 | id | bigint | 默认 | 主键，自增 | 排班ID |
| 2 | worker_id | bigint | 默认 | 外键，非空 | 服务人员ID |
| 3 | date | date | 默认 | 非空 | 日期 |
| 4 | time_slot | varchar | 20 | 非空 | 时间段 |
| 5 | status | enum | - | 非空 | 状态(FREE空闲/BUSY忙碌) |
| 6 | created_at | timestamp | 默认 | 非空 | 创建时间 |

## 表4.6 服务分类表（service_category）

服务分类表用来保存家政服务的分类信息，该表包含分类ID、分类名称、分类描述、父分类ID、状态等字段，其中分类ID是主键且自增，父分类ID是外键，参考本表的分类ID，用于实现多级分类。服务分类表的完整表结构设计如表4.6所示。

| 序号 | 字段名称 | 数据类型 | 长度 | 约束条件 | 字段说明 |
|------|----------|----------|------|----------|----------|
| 1 | id | bigint | 默认 | 主键，自增 | 分类ID |
| 2 | name | varchar | 100 | 非空 | 分类名称 |
| 3 | description | varchar | 500 | 可空 | 分类描述 |
| 4 | parent_id | bigint | 默认 | 外键，可空 | 父分类ID |
| 5 | status | tinyint | 默认 | 非空 | 状态(1启用/0禁用) |
| 6 | created_at | timestamp | 默认 | 非空 | 创建时间 |

## 表4.7 服务项目表（service）

服务项目表用来保存具体的家政服务项目信息，该表包含服务ID、服务名称、服务描述、基础价格、计价单位、所属分类ID、状态、是否热门、评分等字段，其中服务ID是主键且自增，分类ID是外键，参考服务分类表的分类ID。服务项目表的完整表结构设计如表4.7所示。

| 序号 | 字段名称 | 数据类型 | 长度 | 约束条件 | 字段说明 |
|------|----------|----------|------|----------|----------|
| 1 | id | bigint | 默认 | 主键，自增 | 服务ID |
| 2 | name | varchar | 100 | 非空 | 服务名称 |
| 3 | description | varchar | 500 | 可空 | 服务描述 |
| 4 | base_price | decimal | (10,2) | 非空 | 基础价格 |
| 5 | unit | enum | - | 非空 | 计价单位(小时/天/单) |
| 6 | category_id | bigint | 默认 | 外键，可空 | 所属分类ID |
| 7 | status | tinyint | 默认 | 非空 | 状态(1上架/0下架) |
| 8 | hot | tinyint | 默认 | 非空 | 是否热门(1是/0否) |
| 9 | rating | decimal | (3,2) | 可空 | 评分(默认5.00) |
| 10 | created_at | timestamp | 默认 | 非空 | 创建时间 |

## 表4.8 订单表（order）

订单表用来保存用户预约家政服务的订单信息，该表包含订单ID、订单编号、客户ID、服务人员ID、服务项目ID、预约日期、预约时段、地址信息、订单金额、订单状态、备注等字段，其中订单ID是主键且自增，订单编号为唯一约束，客户ID、服务人员ID、服务项目ID、地址ID均为外键，分别参考用户表、服务人员表、服务项目表和用户地址表。订单表的完整表结构设计如表4.8所示。

| 序号 | 字段名称 | 数据类型 | 长度 | 约束条件 | 字段说明 |
|------|----------|----------|------|----------|----------|
| 1 | id | bigint | 默认 | 主键，自增 | 订单ID |
| 2 | order_no | varchar | 40 | 唯一，非空 | 订单编号 |
| 3 | customer_id | bigint | 默认 | 外键，非空 | 客户ID |
| 4 | worker_id | bigint | 默认 | 外键，可空 | 服务人员ID |
| 5 | service_id | bigint | 默认 | 外键，非空 | 服务项目ID |
| 6 | schedule_date | date | 默认 | 非空 | 预约日期 |
| 7 | time_slot | varchar | 20 | 非空 | 预约时段 |
| 8 | address_id | bigint | 默认 | 外键，可空 | 地址ID |
| 9 | address_text | varchar | 300 | 可空 | 地址文本 |
| 10 | amount | decimal | (10,2) | 非空 | 订单金额 |
| 11 | status | enum | - | 非空 | 订单状态(CREATED/ASSIGNED/DOING/DONE/CANCELED) |
| 12 | remark | varchar | 255 | 可空 | 备注 |
| 13 | created_at | timestamp | 默认 | 非空 | 创建时间 |
| 14 | updated_at | timestamp | 默认 | 非空 | 更新时间 |

## 表4.9 订单日志表（order_log）

订单日志表用来保存订单状态变更的历史记录，该表包含日志ID、订单ID、原状态、新状态、操作人ID、备注等字段，其中日志ID是主键且自增，订单ID是外键，参考订单表的订单ID，操作人ID参考用户表的用户ID。订单日志表的完整表结构设计如表4.9所示。

| 序号 | 字段名称 | 数据类型 | 长度 | 约束条件 | 字段说明 |
|------|----------|----------|------|----------|----------|
| 1 | id | bigint | 默认 | 主键，自增 | 日志ID |
| 2 | order_id | bigint | 默认 | 外键，非空 | 订单ID |
| 3 | from_status | enum | - | 可空 | 原状态 |
| 4 | to_status | enum | - | 非空 | 新状态 |
| 5 | op_by | bigint | 默认 | 可空 | 操作人ID |
| 6 | note | varchar | 255 | 可空 | 备注 |
| 7 | created_at | timestamp | 默认 | 非空 | 操作时间 |

## 表4.10 评价表（review）

评价表用来保存用户对已完成订单的评价信息，该表包含评价ID、订单ID、评分、评价内容、图片列表、评价人ID等字段，其中评价ID是主键且自增，订单ID是外键且唯一，参考订单表的订单ID，评价人ID是外键，参考用户表的用户ID。评价表的完整表结构设计如表4.10所示。

| 序号 | 字段名称 | 数据类型 | 长度 | 约束条件 | 字段说明 |
|------|----------|----------|------|----------|----------|
| 1 | id | bigint | 默认 | 主键，自增 | 评价ID |
| 2 | order_id | bigint | 默认 | 唯一，外键 | 订单ID |
| 3 | rating | tinyint | 默认 | 非空 | 评分(1-5) |
| 4 | content | varchar | 500 | 可空 | 评价内容 |
| 5 | imgs | json | 默认 | 可空 | 图片列表 |
| 6 | created_by | bigint | 默认 | 外键，非空 | 评价人ID |
| 7 | created_at | timestamp | 默认 | 非空 | 评价时间 |
